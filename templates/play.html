<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Darts – Click Sim</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      /* Inline styles only for the calibration panel; HUD styles will live in style.css */
      #cal-panel {
        max-width: 900px;
        margin: 16px auto;
        padding: 12px 16px;
        background: #1e1e1e;
        color: #ddd;
        border: 1px solid #333;
        border-radius: 8px;
        font-size: 14px;
      }
      #cal-panel .row {
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 8px 0;
        flex-wrap: wrap;
      }
      #cal-panel input[type="range"] {
        width: 280px;
      }
      #cal-panel input[type="number"] {
        width: 90px;
      }
      #cal-panel label {
        min-width: 120px;
      }
      #cal-panel .val {
        color: #9fe2ff;
        min-width: 48px;
        display: inline-block;
        text-align: right;
      }
      /* 100 mm ruler: visual bar; match it physically with the projector */
      #ruler {
        width: 400px;
        height: 8px;
        background: linear-gradient(90deg, #fff 0 50%, #000 50% 100%);
        background-size: 10px 8px;
        border: 1px solid #555;
      }
      #board-container {
        position: relative;
      }
    </style>
  </head>
  <body>
    <button
      id="btn-cal"
      class="btn btn-ghost"
      style="position: fixed; right: 16px; top: 16px; z-index: 3"
    >
      ⚙︎ Calibrate
    </button>
    <h1>AR Darts – Click to Sim</h1>

    <div id="board-container">
      <img
        src="{{ url_for('static', filename='images/dartboard.png') }}"
        id="dartboard"
        alt="Dartboard"
      />
      <canvas id="overlay"></canvas>
      <!-- Turn badge (top-center) -->
      <div id="turn-badge" class="turn-badge" aria-live="polite">
        Player 1 to throw
      </div>
      <!-- Side HUD panels for projection (click-through) -->
      <div
        id="hud-left"
        class="hud-side left"
        aria-live="polite"
        aria-label="Player 1 HUD"
      >
        <div class="card" id="p1-card">
          <div class="p-name" id="p1-name">Player 1</div>
          <div class="p-line">
            <span class="label">Target:</span>
            <span id="p1-target">To hit: 1</span>
          </div>
          <div class="p-line" id="p1-last">Last hit: –</div>
        </div>
      </div>
      <div
        id="hud-right"
        class="hud-side right"
        aria-live="polite"
        aria-label="Player 2 HUD"
      >
        <div class="card" id="p2-card">
          <div class="p-name" id="p2-name">Player 2</div>
          <div class="p-line">
            <span class="label">Target:</span>
            <span id="p2-target">To hit: 1</span>
          </div>
          <div class="p-line" id="p2-last">Last hit: –</div>
        </div>
      </div>
    </div>

    <!-- Calibration Panel -->
    <div id="cal-panel" class="hidden">
      <div class="row">
        <label>
          Show guides
          <input type="checkbox" id="cal-toggle" checked />
        </label>
      </div>
      <div class="row">
        <label for="cal-radius">Radius fudge</label>
        <input
          type="range"
          id="cal-radius"
          min="0.50"
          max="1.20"
          step="0.001"
          title="Overall radius scale (0.50–1.20)"
        />
        <span class="val" id="cal-r-val">—</span>
      </div>
      <div class="row">
        <label for="cal-dx">Center X (px)</label>
        <input type="number" id="cal-dx" min="-200" max="200" step="1" />
        <span class="val" id="cal-dx-val">—</span>
      </div>
      <div class="row">
        <label for="cal-dy">Center Y (px)</label>
        <input type="number" id="cal-dy" min="-200" max="200" step="1" />
        <span class="val" id="cal-dy-val">—</span>
      </div>
      <div class="row">
        <label for="cal-rot">Rotation (deg)</label>
        <input type="number" id="cal-rot" min="-30" max="30" step="0.1" />
        <span class="val" id="cal-rot-val">—</span>
      </div>
      <div class="row">
        <button id="cal-save" class="btn">Save Calibration</button>
        <small id="cal-saved" style="opacity: 0.85"></small>
      </div>
      <div class="row">
        <div id="ruler" title="100 mm ruler for projector scale"></div>
        <small
          >On projector nights: adjust overall scale until this bar measures
          exactly 100 mm with a real ruler.</small
        >
      </div>
    </div>

    <!-- GAME HUD: Around-the-World prototype -->
    <section id="hud" class="hud">
      <div class="hud-row">
        <div class="hud-cell">Player: <span id="hud-player">P1</span></div>
        <div class="hud-cell">Target: <span id="hud-target">1</span></div>
        <div class="hud-cell">Throws left: <span id="hud-throws">3</span></div>
      </div>
      <div class="hud-row hud-actions">
        <button id="btn-start" type="button">Start</button>
        <button id="btn-undo" type="button" disabled>Undo</button>
        <button id="btn-reset" type="button">Reset</button>
      </div>
      <div class="hud-row">
        <div id="status">Click the board to simulate a dart.</div>
      </div>
      <div class="hud-row">
        <div id="hit-log" class="hit-log" aria-live="polite"></div>
      </div>
    </section>

    <!-- SFX (muted by default; wired in main.js) -->
    <audio id="sfx-hit" preload="auto" muted>
      <source
        src="{{ url_for('static', filename='sfx/hit.mp3') }}"
        type="audio/mpeg"
      />
      <source
        src="{{ url_for('static', filename='sfx/hit.ogg') }}"
        type="audio/ogg"
      />
    </audio>
    <audio id="sfx-bust" preload="auto" muted>
      <source
        src="{{ url_for('static', filename='sfx/bust.mp3') }}"
        type="audio/mpeg"
      />
      <source
        src="{{ url_for('static', filename='sfx/bust.ogg') }}"
        type="audio/ogg"
      />
    </audio>
    <audio id="sfx-win" preload="auto" muted>
      <source
        src="{{ url_for('static', filename='sfx/win.mp3') }}"
        type="audio/mpeg"
      />
      <source
        src="{{ url_for('static', filename='sfx/win.ogg') }}"
        type="audio/ogg"
      />
    </audio>
    <script>
      window.GAME_BOOT = {
        game: "{{ game }}",
        x01Start: {{ start }},
        doubleOut: {{ 'true' if double_out else 'false' }}
      };
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
